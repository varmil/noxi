# 要件定義書

## 概要

この機能は、現在の静的な Group 定数管理システムを動的なデータベース駆動型アプローチに変換します。システムは Web インターフェースを通じて新しい Group の登録を可能にし、既存の Group データとの後方互換性を維持します。

## 用語集

- **Group**: VTuber チャンネルのコレクションまたは組織（例：Hololive、Nijisanji）
- **GroupStrings**: 事前定義されたグループ識別子を含む現在の定数配列
- **Group 登録**: ユーザーが新しい Group 申請を提出するプロセス
- **バックエンドシステム**: Group データオペレーションをハンドリングする NestJS ベースの API サーバー
- **フロントエンドシステム**: ユーザーインターフェースを提供する Next.js ベースの Web アプリケーション
- **マイグレーション**: 既存の定数データをデータベーステーブルに転送するプロセス

## 要件

### 要件 1

**ユーザーストーリー:** システム管理者として、既存の Group 定数をデータベーステーブルに移行したい。これにより Group データを動的に管理できるようになる。

#### 受入基準

1. システムが初期化される時、バックエンドシステムは id、name、iconSrc カラムを持つ Group テーブルを作成する
2. マイグレーションが実行される時、バックエンドシステムは既存の GroupStrings 定数をすべて Group テーブルに挿入する
3. 既存の Group がマイグレーションされる時、バックエンドシステムは各 Group の iconSrc を`/group/${group}/logo.png`形式に設定する
4. マイグレーションが完了する時、バックエンドシステムは既存のすべての Group 参照の参照整合性を維持する
5. Group テーブルが存在する時、バックエンドシステムは id カラムにユニーク制約を適用する

### 要件 2

**ユーザーストーリー:** 開発者として、GroupStrings 定数の代わりに string 型を使用するようにコードベースを更新したい。これによりシステムが動的な Group データを処理できるようになる。

#### 受入基準

1. GroupStrings 参照が見つかった時、バックエンドシステムはそれらを string 型アノテーションに置き換える
2. GroupStrings 参照が見つかった時、フロントエンドシステムはそれらを string 型アノテーションに置き換える
3. 型変更が適用される時、バックエンドシステムは Controller、Service、Domain、Repository レイヤー全体で既存の機能を維持する
4. 型変更が適用される時、フロントエンドシステムは既存のすべての UI 機能を維持する
5. string 型が使用される時、バックエンドシステムはデータベースに対して Group の存在を検証する

### 要件 3

**ユーザーストーリー:** バックエンド開発者として、Group CRUD 操作を実装したい。これにより API エンドポイントを通じて Group を管理できるようになる。

#### 受入基準

1. Group API が要求される時、バックエンドシステムは Group の作成、読み取り、更新、削除のエンドポイントを提供する
2. Group 作成が要求される時、バックエンドシステムは id 形式を小文字の英数字とハイフンのみとして検証する
3. Group 作成が要求される時、バックエンドシステムはユニーク id 制約を適用する
4. Group データが要求される時、バックエンドシステムは id、name、iconSrc を含む Group 情報を返す
5. Group 操作が実行される時、バックエンドシステムは既存のドメインアーキテクチャパターンに従う

### 要件 4

**ユーザーストーリー:** ユーザーとして、Group 登録申請を提出したい。これにより新しい Group をシステムに追加できるようになる。

#### 受入基準

1. ユーザーが Group 登録ページにアクセスする時、フロントエンドシステムは name、id、iconSrc 入力フィールドを持つフォームを表示する
2. ユーザーが Group id を入力する時、フロントエンドシステムは小文字の英数字とハイフンのみとして入力を検証する
3. ユーザーが iconSrc URL を入力する時、フロントエンドシステムは円形の画像プレビューを表示する
4. ユーザーがフォームを送信する時、フロントエンドシステムは申請をバックエンドシステムに送信する
5. 申請が存在する時、フロントエンドシステムは最新 30 件の申請記録を表示する

### 要件 5

**ユーザーストーリー:** ユーザーとして、Group 登録申請履歴を見たい。これにより提出した申請を追跡できるようになる。

#### 受入基準

1. Group 登録ページが読み込まれる時、フロントエンドシステムは最新 30 件の Group 申請を表示する
2. 申請履歴が表示される時、フロントエンドシステムは申請ステータス、提出日、Group 詳細を表示する
3. 申請がリストされる時、フロントエンドシステムは提出日の降順で並べる
4. 申請が存在しない時、フロントエンドシステムは適切な空状態メッセージを表示する
5. 申請データが変更される時、フロントエンドシステムは表示を自動的に更新する

### 要件 6

**ユーザーストーリー:** システムユーザーとして、Group アイコンの相対 URL と絶対 URL の両方をシステムで処理したい。これによりアイコンソースを柔軟にできるようになる。

#### 受入基準

1. iconSrc が相対パスを含む時、フロントエンドシステムはアプリケーションベース URL に対して相対的に解決する
2. iconSrc が絶対 URL を含む時、フロントエンドシステムはそれを直接使用する
3. iconSrc が表示される時、フロントエンドシステムは円形の画像プレビューとしてレンダリングする
4. iconSrc が無効な時、フロントエンドシステムはフォールバックプレースホルダー画像を表示する
5. 既存の Group がレガシーパスを使用する時、フロントエンドシステムは`/group/${group}/logo.png`形式を正しく処理する

### 要件 7

**ユーザーストーリー:** 開発者として、既存の ChannelRegistration パターンに従いたい。これにより Group 登録が現在のシステムアーキテクチャとの一貫性を維持できるようになる。

#### 受入基準

1. Group 登録を実装する時、バックエンドシステムは ChannelRegistration と同じドメインパターンに従う
2. Group 登録エンティティを作成する時、バックエンドシステムは ChannelRegistration エンティティと類似の構造を使用する
3. Group 登録 UI を実装する時、フロントエンドシステムは/channels/add のチャンネル登録ページと同じデザインパターンに従う
4. Group 申請を処理する時、バックエンドシステムは ChannelRegistration と類似の検証と処理ロジックを使用する
5. Group 申請を保存する時、バックエンドシステムは ChannelRegistration と類似の監査証跡を維持する
