# 要件定義書

## 概要

この機能は、Group システムのユーザーインターフェース改善とデータベース拡張を行います。ナビゲーションの改善、Group 表示順序の管理機能、および Next.js 16 アップグレードに伴う認証問題の修正を含みます。

## 用語集

- **Group**: VTuber チャンネルのコレクションまたは組織（例：Hololive、Nijisanji）
- **ナビゲーションシステム**: PC サイドバーとモバイルサイドバーシートを含むサイト内リンクシステム
- **Order**: Group の表示順序を制御するための数値フィールド
- **Auth Scope**: Next.js の認証コンテキストが適切に呼び出される範囲

## 要件

### 要件 1

**ユーザーストーリー:** ユーザーとして、Group 追加ページに簡単にアクセスしたい。これにより Group 登録機能を発見しやすくなる。

#### 受入基準

1. PC でサイトを閲覧する時、ナビゲーションシステムは`/groups/add`ページへのリンクをサイドバーに表示する
2. モバイルでサイトを閲覧する時、ナビゲーションシステムは`/groups/add`ページへのリンクをサイドバーシートに表示する
3. ナビゲーションリンクがクリックされる時、ナビゲーションシステムはユーザーを Group 登録ページに遷移させる
4. ナビゲーションリンクが表示される時、ナビゲーションシステムは適切なアイコンとラベルを表示する
5. 既存のナビゲーション構造が維持される時、ナビゲーションシステムは他のリンクの配置や動作に影響を与えない

### 要件 2

**ユーザーストーリー:** システム管理者として、Group の表示順序を管理したい。これにより Group リストの並び順を制御できるようになる。

#### 受入基準

1. Group テーブルが拡張される時、バックエンドシステムは order カラム（int 型、非 UNIQUE）を追加する
2. Group 一覧が取得される時、バックエンドシステムは常に order の昇順でデータを返す
3. 既存の Group レコードがマイグレーションされる時、バックエンドシステムはすべての order を`1`に設定する
4. 新しい Group が作成される時、バックエンドシステムは order を固定値`99999`に設定する
5. order フィールドが使用される時、バックエンドシステムは order をインフラ層に隠蔽し、ドメイン層やプレゼンテーション層からは見えないようにする

### 要件 3

**ユーザーストーリー:** 開発者として、Header.tsx で発生している「Auth called outside request scope」エラーを修正したい。これによりブラウザでのエラー表示を解消できるようになる。

#### 受入基準

1. Header.tsx で認証エラーが発生する時、フロントエンドシステムは適切なリクエストスコープ内で`auth()`を実行する
2. 認証エラーの解決方法として、フロントエンドシステムは Next.js 16 へのアップグレードを検討する
3. Next.js 16 にアップグレードされる時、フロントエンドシステムはレイアウトの dynamic 化により認証コンテキストエラーを解決する
4. 認証エラーが修正される時、フロントエンドシステムは既存の Header 機能を維持する
5. エラー修正が完了する時、フロントエンドシステムはブラウザコンソールに認証関連エラーを表示しない
